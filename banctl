#!/usr/bin/env bash
# Polkit-guarded control for ban wall
set -euo pipefail
case "${1:-}" in
  up)
    nft -f /etc/nftables.d/nftables-ban.nft
    /usr/local/sbin/ipset_sync.sh
    systemctl start ban-ipset-sync.timer
    ;;
  down)
    systemctl stop ban-ipset-sync.timer || true
    nft flush ruleset
    ;;
  status)
    nft list ruleset | sed -n '1,120p'
    ;;
  *)
    echo "Usage: $0 {up|down|status}" >&2
    exit 2
    ;;
esac