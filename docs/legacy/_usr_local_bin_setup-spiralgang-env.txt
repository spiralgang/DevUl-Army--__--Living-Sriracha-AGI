#!/bin/bash
# SPIRALGANG ENVIRONMENT SETUP - One-time initialization

echo "Setting up SPIRALGANG Omniscient Environment..."

# Make all scripts executable
chmod +x /usr/local/bin/{omni,sfo,power-profile}

# Create initial power profile
power-profile create

# Setup bash integration
cat >> ~/.bashrc << 'EOF'
# SPIRALGANG OMNISCIENT ENVIRONMENT
if [[ -f ~/.power-profiles/active ]]; then
    source ~/.power-profiles/active
fi

# Auto-suggestion on command not found
command_not_found_handle() {
    echo "Command not found: $1"
    omni learn "$@" 2>/dev/null || system-whisperer.sh "$1"
}

# Auto-chmod on file creation
auto_chmod() {
    if [[ "$1" =~ \.(sh|py|run)$ ]]; then
        chmod +x "$1"
        echo "Auto-chmod: $1"
    fi
}

# Watch for new files
alias touch='f(){ touch "$@"; auto_chmod "$1"; }; f'
EOF

# Setup XML syntax highlighting
cp /usr/local/share/spiralgang-syntax.xml ~/.config/

echo "SPIRALGANG Environment Ready!"
echo "Run: source ~/.bashrc"
echo "Then: power-profile auto"